#!/usr/bin/env bash

set -e
PROJECT_BASE_DIR=$(cd $"${BASH_SOURCE%/*}/../../" && pwd)
SCRIPT_BASE_DIR="$PROJECT_BASE_DIR/scripts"
SERVICE_NAME='{{hyphen service.identifier}}'
SERVICE_BASE_DIR="$PROJECT_BASE_DIR/dest/$SERVICE_NAME"

main() {
  generate
  start_service
}

generate() {
  $SCRIPT_BASE_DIR/generate.sh
}

start_service() {
  (cd $SERVICE_BASE_DIR
    ./gradlew --stacktrace \
      generate{{upper-camel service.datasource.name}}JooqSchemaSource \
      bootrun
  )
}

main